var p=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var T=(n,s)=>{for(var t in s)p(n,t,{get:s[t],enumerable:!0})},k=(n,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of L(s))!y.call(n,i)&&i!==t&&p(n,i,{get:()=>s[i],enumerable:!(e=w(s,i))||e.enumerable});return n};var f=n=>k(p({},"__esModule",{value:!0}),n);var l=(n,s,t)=>new Promise((e,i)=>{var o=a=>{try{m(t.next(a))}catch(h){i(h)}},c=a=>{try{m(t.throw(a))}catch(h){i(h)}},m=a=>a.done?e(a.value):Promise.resolve(a.value).then(o,c);m((t=t.apply(n,s)).next())});var b={};T(b,{default:()=>g});module.exports=f(b);var r=require("obsidian");var d=require("obsidian");var v={timeoutDuration:1e4},u=class extends d.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Auto Toggle Mode Settings"}),new d.Setting(t).setName("Timeout duration").setDesc("Time in seconds before switching back to reading mode after window is minimized").addSlider(e=>e.setLimits(1,60,1).setValue(this.plugin.settings.timeoutDuration/1e3).setDynamicTooltip().onChange(i=>l(this,null,function*(){this.plugin.settings.timeoutDuration=i*1e3,yield this.plugin.saveSettings()})))}};var g=class extends r.Plugin{constructor(){super(...arguments);this.clickListener=null;this.visibilityListener=null;this.timer=null;this.lastClickTime=0;this.clickDelay=300}onload(){return l(this,null,function*(){console.log("Loading Auto Toggle Mode plugin"),yield this.loadSettings(),this.addSettingTab(new u(this.app,this)),this.registerEvent(this.app.workspace.on("layout-change",()=>{this.setupClickListener(),this.setupVisibilityListener()})),this.setupClickListener(),this.setupVisibilityListener()})}onunload(){return l(this,null,function*(){console.log("Unloading Auto Toggle Mode plugin"),this.clickListener&&document.removeEventListener("click",this.clickListener),this.visibilityListener&&document.removeEventListener("visibilitychange",this.visibilityListener),this.timer&&clearTimeout(this.timer)})}loadSettings(){return l(this,null,function*(){this.settings=Object.assign({},v,yield this.loadData())})}saveSettings(){return l(this,null,function*(){yield this.saveData(this.settings)})}setupClickListener(){this.clickListener&&document.removeEventListener("click",this.clickListener),this.clickListener=t=>{this.handleDocumentClick(t)},document.addEventListener("click",this.clickListener)}setupVisibilityListener(){this.visibilityListener&&document.removeEventListener("visibilitychange",this.visibilityListener),this.visibilityListener=()=>{this.handleVisibilityChange()},document.addEventListener("visibilitychange",this.visibilityListener)}isModeToggleControl(t){let e=t;for(;e;){if(e.classList&&e.getAttribute("aria-label")){let i=e.getAttribute("aria-label");if(i&&(i.includes("mode")||i.includes("\u6A21\u5F0F")||i.includes("Edit")||i.includes("\u7F16\u8F91")||i.includes("Preview")||i.includes("\u9884\u89C8")))return!0}if(e.classList&&e.classList.contains("view-action")||e.classList&&e.classList.contains("nav-action-button")||e.classList&&e.classList.contains("clickable-icon"))return!0;if(e=e.parentElement,e&&e.closest&&e.closest(".workspace-split"))break}return!1}handleDocumentClick(t){let e=Date.now();if(e-this.lastClickTime<this.clickDelay)return;this.lastClickTime=e;let i=t.target;if(this.isModeToggleControl(i)){console.log("Clicked on mode toggle control, allowing Obsidian to handle it");return}let o=this.app.workspace.getActiveViewOfType(r.MarkdownView);if(!o)return;let c=o.getState();o.getViewType()==="markdown"&&c.mode!=="source"?(console.log("Switching from reading mode to editing mode"),o.leaf.setViewState({type:"markdown",state:{mode:"source"}})):o.getViewType()==="markdown"&&c.mode==="source"&&console.log("Already in editing mode, not interfering with user actions")}handleVisibilityChange(){let t=this.app.workspace.getActiveViewOfType(r.MarkdownView);document.hidden&&t&&t.getViewType()==="markdown"&&t.getState().mode==="source"?(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{let e=this.app.workspace.getActiveViewOfType(r.MarkdownView);e&&e.getViewType()==="markdown"&&e.getState().mode==="source"&&(console.log("Switching back to reading mode after window minimization timeout"),e.leaf.setViewState({type:"markdown",state:{mode:"preview"}})),this.timer=null},this.settings.timeoutDuration)):!document.hidden&&this.timer&&(clearTimeout(this.timer),this.timer=null)}};0&&(module.exports={});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBQbHVnaW4sIE1hcmtkb3duVmlldyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IEF1dG9Ub2dnbGVNb2RlU2V0dGluZ1RhYiwgQXV0b1RvZ2dsZU1vZGVTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gJy4vc2V0dGluZ3MnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRvVG9nZ2xlTW9kZVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IEF1dG9Ub2dnbGVNb2RlU2V0dGluZ3M7XG4gICAgcHJpdmF0ZSBjbGlja0xpc3RlbmVyOiBFdmVudExpc3RlbmVyIHwgbnVsbCA9IG51bGw7XG4gICAgcHJpdmF0ZSB2aXNpYmlsaXR5TGlzdGVuZXI6IEV2ZW50TGlzdGVuZXIgfCBudWxsID0gbnVsbDtcbiAgICBwcml2YXRlIHRpbWVyOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICAgIHByaXZhdGUgbGFzdENsaWNrVGltZTogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIGNsaWNrRGVsYXk6IG51bWJlciA9IDMwMDsgLy8gMzAwbXMgXHU5NjMyXHU2Mjk2XHU1RUY2XHU4RkRGXG5cbiAgICBhc3luYyBvbmxvYWQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdMb2FkaW5nIEF1dG8gVG9nZ2xlIE1vZGUgcGx1Z2luJyk7XG4gICAgICAgIFxuICAgICAgICAvLyBMb2FkIHNldHRpbmdzXG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgc2V0dGluZ3MgdGFiXG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgQXV0b1RvZ2dsZU1vZGVTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBSZWdpc3RlciBldmVudCB0byBoYW5kbGUgbGF5b3V0IGNoYW5nZXNcbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKCdsYXlvdXQtY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0dXBDbGlja0xpc3RlbmVyKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR1cFZpc2liaWxpdHlMaXN0ZW5lcigpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEluaXRpYWwgc2V0dXBcbiAgICAgICAgdGhpcy5zZXR1cENsaWNrTGlzdGVuZXIoKTtcbiAgICAgICAgdGhpcy5zZXR1cFZpc2liaWxpdHlMaXN0ZW5lcigpO1xuICAgIH1cblxuICAgIGFzeW5jIG9udW5sb2FkKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnVW5sb2FkaW5nIEF1dG8gVG9nZ2xlIE1vZGUgcGx1Z2luJyk7XG4gICAgICAgIFxuICAgICAgICAvLyBDbGVhbiB1cCBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgaWYgKHRoaXMuY2xpY2tMaXN0ZW5lcikge1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsaWNrTGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAodGhpcy52aXNpYmlsaXR5TGlzdGVuZXIpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Zpc2liaWxpdHljaGFuZ2UnLCB0aGlzLnZpc2liaWxpdHlMaXN0ZW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENsZWFyIHRpbWVyIGlmIGFjdGl2ZVxuICAgICAgICBpZiAodGhpcy50aW1lcikge1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgICAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgICB9XG5cbiAgICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXR1cENsaWNrTGlzdGVuZXIoKSB7XG4gICAgICAgIC8vIFJlbW92ZSBleGlzdGluZyBsaXN0ZW5lciBpZiBhbnlcbiAgICAgICAgaWYgKHRoaXMuY2xpY2tMaXN0ZW5lcikge1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsaWNrTGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBBZGQgY2xpY2sgbGlzdGVuZXIgdG8gdGhlIGRvY3VtZW50XG4gICAgICAgIHRoaXMuY2xpY2tMaXN0ZW5lciA9IChlOiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZURvY3VtZW50Q2xpY2soZSk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xpY2tMaXN0ZW5lcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXR1cFZpc2liaWxpdHlMaXN0ZW5lcigpIHtcbiAgICAgICAgLy8gUmVtb3ZlIGV4aXN0aW5nIHZpc2liaWxpdHkgbGlzdGVuZXIgaWYgYW55XG4gICAgICAgIGlmICh0aGlzLnZpc2liaWxpdHlMaXN0ZW5lcikge1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndmlzaWJpbGl0eWNoYW5nZScsIHRoaXMudmlzaWJpbGl0eUxpc3RlbmVyKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gQWRkIHZpc2liaWxpdHkgY2hhbmdlIGxpc3RlbmVyXG4gICAgICAgIHRoaXMudmlzaWJpbGl0eUxpc3RlbmVyID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVWaXNpYmlsaXR5Q2hhbmdlKCk7XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgdGhpcy52aXNpYmlsaXR5TGlzdGVuZXIpO1xuICAgIH1cblxuICAgIC8vIFx1NjhDMFx1NjdFNVx1NTE0M1x1N0QyMFx1NjYyRlx1NTQyNlx1NEUzQSBPYnNpZGlhbiBcdTc2ODRcdTZBMjFcdTVGMEZcdTUyMDdcdTYzNjJcdTYzQTdcdTRFRjZcbiAgICBwcml2YXRlIGlzTW9kZVRvZ2dsZUNvbnRyb2woZWxlbWVudDogSFRNTEVsZW1lbnQpOiBib29sZWFuIHtcbiAgICAgICAgLy8gXHU2OEMwXHU2N0U1XHU1MTQzXHU3RDIwXHU2NzJDXHU4RUFCXHU2MjE2XHU1MTc2XHU3MjM2XHU1MTQzXHU3RDIwXHU2NjJGXHU1NDI2XHU1MTc3XHU2NzA5IE9ic2lkaWFuIFx1NkEyMVx1NUYwRlx1NTIwN1x1NjM2Mlx1NjNBN1x1NEVGNlx1NzY4NFx1NzI3OVx1NUY4MVxuICAgICAgICBsZXQgY3VycmVudEVsZW1lbnQ6IEhUTUxFbGVtZW50IHwgbnVsbCA9IGVsZW1lbnQ7XG4gICAgICAgIFxuICAgICAgICB3aGlsZSAoY3VycmVudEVsZW1lbnQpIHtcbiAgICAgICAgICAgIC8vIFx1NjhDMFx1NjdFNVx1NjYyRlx1NTQyNlx1NEUzQVx1NkEyMVx1NUYwRlx1NTIwN1x1NjM2Mlx1NjMwOVx1OTRBRVxuICAgICAgICAgICAgaWYgKGN1cnJlbnRFbGVtZW50LmNsYXNzTGlzdCAmJiBjdXJyZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFyaWFMYWJlbCA9IGN1cnJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcpO1xuICAgICAgICAgICAgICAgIGlmIChhcmlhTGFiZWwgJiYgKGFyaWFMYWJlbC5pbmNsdWRlcygnbW9kZScpIHx8IGFyaWFMYWJlbC5pbmNsdWRlcygnXHU2QTIxXHU1RjBGJykgfHwgXG4gICAgICAgICAgICAgICAgICAgIGFyaWFMYWJlbC5pbmNsdWRlcygnRWRpdCcpIHx8IGFyaWFMYWJlbC5pbmNsdWRlcygnXHU3RjE2XHU4RjkxJykgfHxcbiAgICAgICAgICAgICAgICAgICAgYXJpYUxhYmVsLmluY2x1ZGVzKCdQcmV2aWV3JykgfHwgYXJpYUxhYmVsLmluY2x1ZGVzKCdcdTk4ODRcdTg5QzgnKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBcdTY4QzBcdTY3RTVcdTY2MkZcdTU0MjZcdTRFM0FcdTg5QzZcdTU2RkVcdTUyQThcdTRGNUNcdTYzMDlcdTk0QUVcdTVCQjlcdTU2NjhcbiAgICAgICAgICAgIGlmIChjdXJyZW50RWxlbWVudC5jbGFzc0xpc3QgJiYgY3VycmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCd2aWV3LWFjdGlvbicpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFx1NjhDMFx1NjdFNVx1NjYyRlx1NTQyNlx1NEUzQVx1NUJGQ1x1ODIyQVx1NjgwRlx1NEUyRFx1NzY4NFx1NjMwOVx1OTRBRVxuICAgICAgICAgICAgaWYgKGN1cnJlbnRFbGVtZW50LmNsYXNzTGlzdCAmJiBjdXJyZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ25hdi1hY3Rpb24tYnV0dG9uJykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gXHU2OEMwXHU2N0U1XHU2NjJGXHU1NDI2XHU0RTNBXHU1REU1XHU1MTc3XHU2ODBGXHU2MzA5XHU5NEFFXG4gICAgICAgICAgICBpZiAoY3VycmVudEVsZW1lbnQuY2xhc3NMaXN0ICYmIGN1cnJlbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnY2xpY2thYmxlLWljb24nKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBcdTU0MTFcdTRFMEFcdTY3RTVcdTYyN0VcdTcyMzZcdTUxNDNcdTdEMjBcbiAgICAgICAgICAgIGN1cnJlbnRFbGVtZW50ID0gY3VycmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gXHU5NjUwXHU1MjM2XHU2N0U1XHU2MjdFXHU1QzQyXHU3RUE3XHVGRjBDXHU5MDdGXHU1MTREXHU2MDI3XHU4MEZEXHU5NUVFXHU5ODk4XG4gICAgICAgICAgICBpZiAoY3VycmVudEVsZW1lbnQgJiYgY3VycmVudEVsZW1lbnQuY2xvc2VzdCAmJiBjdXJyZW50RWxlbWVudC5jbG9zZXN0KCcud29ya3NwYWNlLXNwbGl0JykpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRG9jdW1lbnRDbGljayhlOiBNb3VzZUV2ZW50KSB7XG4gICAgICAgIC8vIFx1OTYzMlx1NjI5Nlx1NTkwNFx1NzQwNlx1RkYxQVx1OTA3Rlx1NTE0RFx1NzdFRFx1NjVGNlx1OTVGNFx1NTE4NVx1NTkxQVx1NkIyMVx1NzBCOVx1NTFGQlxuICAgICAgICBjb25zdCBjdXJyZW50VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIGlmIChjdXJyZW50VGltZSAtIHRoaXMubGFzdENsaWNrVGltZSA8IHRoaXMuY2xpY2tEZWxheSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGFzdENsaWNrVGltZSA9IGN1cnJlbnRUaW1lO1xuICAgICAgICBcbiAgICAgICAgLy8gXHU2OEMwXHU2N0U1XHU2NjJGXHU1NDI2XHU3MEI5XHU1MUZCXHU0RTg2IE9ic2lkaWFuIFx1NzY4NFx1NkEyMVx1NUYwRlx1NTIwN1x1NjM2Mlx1NjNBN1x1NEVGNlxuICAgICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgaWYgKHRoaXMuaXNNb2RlVG9nZ2xlQ29udHJvbCh0YXJnZXQpKSB7XG4gICAgICAgICAgICAvLyBcdTU5ODJcdTY3OUNcdTcwQjlcdTUxRkJcdTc2ODRcdTY2MkZcdTZBMjFcdTVGMEZcdTUyMDdcdTYzNjJcdTYzQTdcdTRFRjZcdUZGMENcdTRFMERcdThGREJcdTg4NENcdTVFNzJcdTk4ODRcdUZGMENcdThCQTkgT2JzaWRpYW4gXHU4MUVBXHU1REYxXHU1OTA0XHU3NDA2XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ2xpY2tlZCBvbiBtb2RlIHRvZ2dsZSBjb250cm9sLCBhbGxvd2luZyBPYnNpZGlhbiB0byBoYW5kbGUgaXQnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gXHU4M0I3XHU1M0Q2XHU1RjUzXHU1MjREXHU4OUM2XHU1NkZFXG4gICAgICAgIGNvbnN0IHZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgICBpZiAoIXZpZXcpIHJldHVybjtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHN0YXRlID0gdmlldy5nZXRTdGF0ZSgpO1xuICAgICAgICBcbiAgICAgICAgLy8gXHU1OTgyXHU2NzlDXHU1RjUzXHU1MjREXHU1OTA0XHU0RThFXHU5NjA1XHU4QkZCXHU2QTIxXHU1RjBGXHVGRjBDXHU3MEI5XHU1MUZCXHU1NDBFXHU1MjA3XHU2MzYyXHU1MjMwXHU3RjE2XHU4RjkxXHU2QTIxXHU1RjBGXG4gICAgICAgIGlmICh2aWV3LmdldFZpZXdUeXBlKCkgPT09ICdtYXJrZG93bicgJiYgc3RhdGUubW9kZSAhPT0gJ3NvdXJjZScpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTd2l0Y2hpbmcgZnJvbSByZWFkaW5nIG1vZGUgdG8gZWRpdGluZyBtb2RlJyk7XG4gICAgICAgICAgICB2aWV3LmxlYWYuc2V0Vmlld1N0YXRlKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnbWFya2Rvd24nLFxuICAgICAgICAgICAgICAgIHN0YXRlOiB7IG1vZGU6ICdzb3VyY2UnIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIFx1NTk4Mlx1Njc5Q1x1NUY1M1x1NTI0RFx1NTkwNFx1NEU4RVx1N0YxNlx1OEY5MVx1NkEyMVx1NUYwRlx1RkYwQ1x1NEUwRFx1OEZEQlx1ODg0Q1x1NUU3Mlx1OTg4NFx1RkYwQ1x1NzUyOFx1NjIzN1x1NTNFRlx1NEVFNVx1OTAxQVx1OEZDNyBPYnNpZGlhbiBcdTc2ODRcdTYzQTdcdTRFRjZcdTUyMDdcdTYzNjJcdTU2REVcdTk2MDVcdThCRkJcdTZBMjFcdTVGMEZcbiAgICAgICAgLy8gXHU4RkQ5XHU2ODM3XHU1QzMxXHU5MDdGXHU1MTREXHU0RTg2XHU1RkFBXHU3M0FGXHU1MjA3XHU2MzYyXHU3Njg0XHU5NUVFXHU5ODk4XG4gICAgICAgIGVsc2UgaWYgKHZpZXcuZ2V0Vmlld1R5cGUoKSA9PT0gJ21hcmtkb3duJyAmJiBzdGF0ZS5tb2RlID09PSAnc291cmNlJykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0FscmVhZHkgaW4gZWRpdGluZyBtb2RlLCBub3QgaW50ZXJmZXJpbmcgd2l0aCB1c2VyIGFjdGlvbnMnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlVmlzaWJpbGl0eUNoYW5nZSgpIHtcbiAgICAgICAgLy8gSWYgZG9jdW1lbnQgaXMgaGlkZGVuICh3aW5kb3cgbWluaW1pemVkIG9yIHRhYiBzd2l0Y2hlZCkgYW5kIHdlJ3JlIGluIGVkaXRpbmcgbW9kZVxuICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgaWYgKGRvY3VtZW50LmhpZGRlbiAmJiB2aWV3ICYmIHZpZXcuZ2V0Vmlld1R5cGUoKSA9PT0gJ21hcmtkb3duJyAmJiB2aWV3LmdldFN0YXRlKCkubW9kZSA9PT0gJ3NvdXJjZScpIHtcbiAgICAgICAgICAgIC8vIENsZWFyIGFueSBleGlzdGluZyB0aW1lclxuICAgICAgICAgICAgaWYgKHRoaXMudGltZXIpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIFNldCB0aW1lciB0byBzd2l0Y2ggYmFjayB0byByZWFkaW5nIG1vZGUgYWZ0ZXIgY29uZmlndXJlZCBkdXJhdGlvblxuICAgICAgICAgICAgdGhpcy50aW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRWaWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFZpZXcgJiYgY3VycmVudFZpZXcuZ2V0Vmlld1R5cGUoKSA9PT0gJ21hcmtkb3duJyAmJiBjdXJyZW50Vmlldy5nZXRTdGF0ZSgpLm1vZGUgPT09ICdzb3VyY2UnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFN3aXRjaCBiYWNrIHRvIHJlYWRpbmcgbW9kZVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3dpdGNoaW5nIGJhY2sgdG8gcmVhZGluZyBtb2RlIGFmdGVyIHdpbmRvdyBtaW5pbWl6YXRpb24gdGltZW91dCcpO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Vmlldy5sZWFmLnNldFZpZXdTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnbWFya2Rvd24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6IHsgbW9kZTogJ3ByZXZpZXcnIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMudGltZXIgPSBudWxsO1xuICAgICAgICAgICAgfSwgdGhpcy5zZXR0aW5ncy50aW1lb3V0RHVyYXRpb24pOyAvLyBVc2UgY29uZmlndXJlZCB0aW1lb3V0IGR1cmF0aW9uXG4gICAgICAgIH0gZWxzZSBpZiAoIWRvY3VtZW50LmhpZGRlbiAmJiB0aGlzLnRpbWVyKSB7XG4gICAgICAgICAgICAvLyBJZiBkb2N1bWVudCBpcyB2aXNpYmxlIGFnYWluIGFuZCB3ZSBoYXZlIGEgdGltZXIsIGNsZWFyIGl0XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7XG4gICAgICAgICAgICB0aGlzLnRpbWVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn0iLCAiaW1wb3J0IHsgQXBwLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nIH0gZnJvbSAnb2JzaWRpYW4nO1xuXG5leHBvcnQgaW50ZXJmYWNlIEF1dG9Ub2dnbGVNb2RlU2V0dGluZ3Mge1xuICAgIHRpbWVvdXREdXJhdGlvbjogbnVtYmVyOyAvLyBpbiBtaWxsaXNlY29uZHNcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IEF1dG9Ub2dnbGVNb2RlU2V0dGluZ3MgPSB7XG4gICAgdGltZW91dER1cmF0aW9uOiAxMDAwMCAvLyAxMCBzZWNvbmRzXG59XG5cbmV4cG9ydCBjbGFzcyBBdXRvVG9nZ2xlTW9kZVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgICBwbHVnaW46IGFueTsgLy8gV2UnbGwgdXNlIGFueSB0byBhdm9pZCBjaXJjdWxhciBkZXBlbmRlbmN5XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBhbnkpIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB9XG5cbiAgICBkaXNwbGF5KCk6IHZvaWQge1xuICAgICAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnQXV0byBUb2dnbGUgTW9kZSBTZXR0aW5ncycgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZSgnVGltZW91dCBkdXJhdGlvbicpXG4gICAgICAgICAgICAuc2V0RGVzYygnVGltZSBpbiBzZWNvbmRzIGJlZm9yZSBzd2l0Y2hpbmcgYmFjayB0byByZWFkaW5nIG1vZGUgYWZ0ZXIgd2luZG93IGlzIG1pbmltaXplZCcpXG4gICAgICAgICAgICAuYWRkU2xpZGVyKHNsaWRlciA9PiBzbGlkZXJcbiAgICAgICAgICAgICAgICAuc2V0TGltaXRzKDEsIDYwLCAxKVxuICAgICAgICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy50aW1lb3V0RHVyYXRpb24gLyAxMDAwKVxuICAgICAgICAgICAgICAgIC5zZXREeW5hbWljVG9vbHRpcCgpXG4gICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50aW1lb3V0RHVyYXRpb24gPSB2YWx1ZSAqIDEwMDA7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAg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QVFBLEVBQUssWUFBWSxJQUFNLFlBQWNBLEVBQUssU0FBUyxFQUFFLE9BQVMsVUFFckYsS0FBSyxPQUNMLGFBQWEsS0FBSyxLQUFLLEVBSTNCLEtBQUssTUFBUSxXQUFXLElBQU0sQ0FDMUIsSUFBTUUsRUFBYyxLQUFLLElBQUksVUFBVSxvQkFBb0IsY0FBWSxFQUNuRUEsR0FBZUEsRUFBWSxZQUFZLElBQU0sWUFBY0EsRUFBWSxTQUFTLEVBQUUsT0FBUyxXQUUzRixRQUFRLElBQUksa0VBQWtFLEVBQzlFQSxFQUFZLEtBQUssYUFBYSxDQUMxQixLQUFNLFdBQ04sTUFBTyxDQUFFLEtBQU0sU0FBVSxDQUM3QixDQUFDLEdBRUwsS0FBSyxNQUFRLElBQ2pCLEVBQUcsS0FBSyxTQUFTLGVBQWUsR0FDekIsQ0FBQyxTQUFTLFFBQVUsS0FBSyxRQUVoQyxhQUFhLEtBQUssS0FBSyxFQUN2QixLQUFLLE1BQVEsS0FFckIsQ0FDSiIsCiAgIm5hbWVzIjogWyJtYWluX2V4cG9ydHMiLCAiX19leHBvcnQiLCAiQXV0b1RvZ2dsZU1vZGVQbHVnaW4iLCAiX190b0NvbW1vbkpTIiwgImltcG9ydF9vYnNpZGlhbiIsICJpbXBvcnRfb2JzaWRpYW4iLCAiREVGQVVMVF9TRVRUSU5HUyIsICJBdXRvVG9nZ2xlTW9kZVNldHRpbmdUYWIiLCAiYXBwIiwgInBsdWdpbiIsICJjb250YWluZXJFbCIsICJzbGlkZXIiLCAidmFsdWUiLCAiX19hc3luYyIsICJBdXRvVG9nZ2xlTW9kZVBsdWdpbiIsICJfX2FzeW5jIiwgIkF1dG9Ub2dnbGVNb2RlU2V0dGluZ1RhYiIsICJERUZBVUxUX1NFVFRJTkdTIiwgImUiLCAiZWxlbWVudCIsICJjdXJyZW50RWxlbWVudCIsICJhcmlhTGFiZWwiLCAiY3VycmVudFRpbWUiLCAidGFyZ2V0IiwgInZpZXciLCAic3RhdGUiLCAiY3VycmVudFZpZXciXQp9Cg==
